pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
poke(0x5f2e,1)

function _init()
  changePalette()
  
  p_moving = false;
  p_dodging = false;

  p={
    x=8,
    y=24,
    l=8,
    h=8,
    speed=3,
    tick=0,
    frame=1,
    step=4,
    runnning_sprite={2,3,4},
    running_up_sprite={5,6},
    dodge_max_cooldown=50,
    can_roll=true,
    timer_dodge=0,
    dodge_sprite={17, 18, 19, 20},
    bullets={}
  }
end

function changePalette()
  pal({[0]=0,128,5,134,141,2,136,8,142,7,143,140,131,129,1,6},1)
end


function _update60()
  --check_p_moving()
  update_p()
  update_camera()
  update_bullets()
end

function _draw()
  cls()
  draw_map()
  draw_p()
  draw_bullets()
end

-->8
--player

function reset_p()
  -- p.tick = 0
  -- p.frame = 1
  -- p.step = 4
  p.speed = 3
end

function check_p_moving()
  if (btn(‚û°Ô∏è) or btn(‚¨ÖÔ∏è) or btn(‚¨ÜÔ∏è) or btn(‚¨áÔ∏è)) then
    p_moving = true
  else
    p_moving = false
  end
  
end

function update_p()

		--function update p
		
  check_p_moving()
  update_dodging()
  
  --mvmt
  
  tmpX = p.x
  tmpY = p.y

  if (btn(‚û°Ô∏è)) then 
    tmpX+=p.speed
    p.flip = false
  end
  if (btn(‚¨ÖÔ∏è)) then
    tmpX-=p.speed 
    p.flip = true
  end
  
  if (btn(‚¨ÜÔ∏è)) tmpY-=p.speed
  if (btn(‚¨áÔ∏è)) tmpY+=p.speed
  if (btn(‚ùé)) shoot()
  
  p.x = mid(8, tmpX, 240)
  p.y = mid(16, tmpY, 240)

  --dodge
  
  if (p_moving) then
   if (btn(üÖæÔ∏è) and p.can_roll) then
   --and p.timer_dodge<=0
    p.timer_dodge=1
   end
  end
  
end

function draw_p()

  draw_shadow(p, 0, 3)

  if p_moving then
    if p_dodging then 
    
      dodge_animate(p)
      --spr(p.dodge_sprite[p.frame], p.x, p.y, 1, 1, p.flip)
      --p.roll_current_cooldown += 1
      spr(16+ceil((p.timer_dodge/3)), p.x, p.y, 1, 1, p.flip)

      --print(p.frame, p.x + 10, p.y - 10, 7)
      
      --[[
      if (p.frame == #p.dodge_sprite) then
        reset_p()
        p_dodging = false
        p.can_roll = true
      end
      ]]
      
    else
      running_animate(p)
      
      spr(p.runnning_sprite[p.frame], p.x, p.y, 1, 1, p.flip)
    end
  else
    spr(1, p.x, p.y, 1, 1, p.flip)
  end
end

function update_dodging()
	p_dodging = false
  p.speed = 2
	if p.timer_dodge>0 and p.timer_dodge<p.dodge_max_cooldown and p_moving then
		p.timer_dodge+=1
    if p.timer_dodge<12 then
      p.can_roll = false
      p.speed = 4
      p_dodging = true
    end
  else
    p.timer_dodge=0
    p.can_roll = true
 end
end
-->8
--map

function draw_map() 
  map(0,0,0,0,128,128)
end

-->8
--camera

function update_camera()
  camera(p.x - 64, p.y - 64)
end

-->8
--utils

function animate(tick, step, frame, sprites)
  tick=(tick+1)%step
  if (tick==0) frame=frame%#sprites+1
end

function running_animate(object)
  object.tick=(object.tick+1)%object.step
  if (object.tick==0) object.frame=object.frame%#object.runnning_sprite+1
end

function dodge_animate(object)
  object.tick=(object.tick+1)%object.step
  if (object.tick==0) object.frame=object.frame%#object.dodge_sprite+1
end

function draw_shadow(o, x, y)
  fillp(‚ñí)
  circfill(o.x+o.l/2+x,o.y+o.h/2+y, o.l/2, 13)
  fillp()
end

-->8
-- bullets

function shoot()
  add(p.bullets, {
    x=p.x,
    y=p.y,
    speed=4,
  })
end

function update_bullets()
  for bullet in all(p.bullets) do
    bullet.x += bullet.speed
    if (bullet.x > 246) del(p.bullets, bullet)
  end
end

function draw_bullets()
  for bullet in all(p.bullets) do
    sspr(0, 0, 8, 8, bullet.x, bullet.y)
  end
end

__gfx__
0770000000fff90000fff90000fff9000000000000fff90000000000000000000000000000000000000000000000000000000000000000000000000000000000
78a700000ffaaa900ffaaa900fffaf9000fff9000fffff9000fff900000000000000000000000000000000000000000000000000000000000000000000000000
077000000faaaa900f9aaa907ffaaa900ffaaa900fffff900fffff90000000000000000000000000000000000000000000000000000000000000000000000000
000000000777777077777770077777700f9aaa90077777700fffff90000000000000000000000000000000000000000000000000000000000000000000000000
000000007fdfffd00fdfffd0ffdfffd07777777000dfffd007777770000000000000000000000000000000000000000000000000000000000000000000000000
000000000fdfffd0f0dffd0000dffd00ffdfffd000dfffd000dfffd0000000000000000000000000000000000000000000000000000000000000000000000000
000000000ddddd0002dddd000ddd2d000ddddd000dddd2000d2ddd00000000000000000000000000000000000000000000000000000000000000000000000000
00000000002002000000020000200000002002000020000000000200000000000000000000000000000000000000000000000000000000000000000000000000
00000000000007000000007002002000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ff7ff0000dd07000dddd07070dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000ddd79ff02dff7f00ddffd770f7ffd200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000002dff7aaf00dff79f0dfff770f97ffd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000dff7aaf2dff7aa90df777909aa7ffd20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000002dff7aa90df77aa90d7aaa909aa77fd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000dd79900dd7aa90097aaa9009aa7dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000990000999900009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fdeeeedfffffffff000ffffffffff000fdeeeedffdeeeedfeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeddeeddeeeeddeeddeeeeeeeeeeeeeeee0000000000000000
fdeeeedfdddddddd00fddddddddddf00ddeeeedffdeeeeddeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeddeeddeeeeddeeddeeeeeeeeeeeeeeee0000000000000000
fdeeeedfeeeeeeee0fdeeeeeeeeeedf0eeeeeedffdeeeeeeeeddddddddddddeeeeeeeeeeeeeeeeeeeeeeddeeeeddeeeeeeedddddddedddee0000000000000000
fdeeeedfeeeeeeeefdeeeeeeeeeeeedfeeeeeedffdeeeeeeeeddddddddddddeeeeeeeeeeeeeeeeeeeeeeddeeeeddeeeeeeeeeeddeeddedee0000000000000000
fdeeeedfeeeeeeeefdeeeeeeeeeeeedfeeeeeedffdeeeeeeeeddeeeeeeeeddeeeeeeecccccceeeeedddddccccccdddddeeeeeeeeeeeeddee0000000000000000
fdeeeedfeeeeeeeefdeeeeeeeeeeeedfeeeeedf00fdeeeeeeeddeeeeeeeeddeeeeeecccccc9ceeeeddddcccccc9cddddeeddeeeeeeeedeee0000000000000000
fdeeeedfddddddddfdeeeeddddeeeedfdddddf0000fdddddeeddeeddddeeddeeeeecccccc989ceeeeeecccccc989ceeeeeddeedddeeeedee0000000000000000
fdeeeedffffffffffdeeeedffdeeeedffffff000000fffffeeddeeddddeeddeeeeeccccccc9cceeeeeeccccccc9cceeeeedeeedeedeeedee0000000000000000
ddddddddddddddddeeeeeeeecccccccc0000000000000000eeddeeddddeeddeeeeeccc9cccccceeeeeeccc9cccccceeeeeddeeddddeedeee0000000000000000
deeeeddddeeeddddeeeeeeeeccccccce0000000000000000eeddeeddddeeddeeeeecc989ccccceeeeeecc989ccccceeeeeddeedddeeeddee0000000000000000
ddeeddeeddeddddeeeeeeeeeccccccee0000000000000000eeddeeeeeeeeddeeeeeecc9ccccceeeeddddcc9cccccddddeeeeeeeeeeeeedee0000000000000000
dddddddeddddddeeeeeeeeeeccccceee0000000000000000eeddeeeeeeeeddeeeeeeecccccceeeeedddddccccccdddddeedeeeeeeeeeddee0000000000000000
ddddddddeddddddeeeeeeeeecccceeee0000000000000000eeddddddddddddeeeeeeeeeeeeeeeeeeeeeeddeeeeddeeeeeeddeddddddddeee0000000000000000
deeedddddddeddddeeeeeeeeceeeeeee0000000000000000eeddddddddddddeeeeeeeeeeeeeeeeeeeeeeddeeeeddeeeeeeddddeededdddee0000000000000000
ddeeddedddeeedddeeeeeeeeeeeeeeee0000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeddeeddeeeeddeeddeeeeeeeeeeeeeeee0000000000000000
dddddddddddeddddeeeeeeeeeeeeeeee0000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeddeeddeeeeddeeddeeeeeeeeeeeeeeee0000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
2221212121212121212121212121212121212121212121212121212121212123000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2030313130303130303130313030313031303130313031313130313130313020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2030313031303031313031303030313130313031313130313031303031313020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20333226272627262726272627262726272627262726272627262726272c2d20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2032282b373637363736373637363736373637363736373637363736373c3d20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20263a3b27262726272627262726272627262726272c2d262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2036373637363736373637363736373637363736373c3d363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2026272627262726272627262726272627262726272627262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
203637363d3c373637363736373637362a2b373637362a2b3736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20262732322c272627262726272627263a3b272627263a3b2726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20363d32323c373637362a2b37363736373637362a2b37363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20262d32322c272627263a3b27262726272627263a3b27262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20363732323c37363736373637362a2b37363736373637363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20262726272627262726272627263a3b27262726272627262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
203c3d3c37363736373637363736373637363736373637363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
202c272c2726272627262726272627262726272c2d2627262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20363736373637363736373637363d3c373637363d3c37362a2b373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
202627262726272627262726272c2d2c2d262726272c27263a3b272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2036373637362a2b37363736373c37363d363736373637363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2026272627263a3b27262726272627262d2c2726272627262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2036373637363736373637363736373637363736373637363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2026272627262726272c2d2627262726272627262d2c2d2c2d2c272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2036373637363736373c3d3637362a2b37363736373637363d3c373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20262726272627262d26272627263a3b27262726272627262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
203637363736373c3d363736373637363736373c373637363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
202c2d2627262d26272627262726272627262d28292627262726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20363d3c3736373637363d362a2b37363736373839362a2b3736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
202627262d26272627262d263a3b27262732323232263a3b2726272627262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
203637363d3c37362a2b3736373637363d323232323c37363736373637363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20262726272c2d263a3b27262726273232323232323232323226272c2d262720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20363d3c37363d36373637363736373232323232323232323236373c3d363720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2521212121212121212121212121212121212121212121212121212121212124000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
